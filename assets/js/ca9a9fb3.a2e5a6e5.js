"use strict";(self.webpackChunkflet_dev=self.webpackChunkflet_dev||[]).push([[6517],{3905:function(e,t,n){n.d(t,{Zo:function(){return s},kt:function(){return g}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=a.createContext({}),u=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},s=function(e){var t=u(e.components);return a.createElement(p.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,p=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),c=u(n),h=i,g=c["".concat(p,".").concat(h)]||c[h]||d[h]||o;return n?a.createElement(g,r(r({ref:t},s),{},{components:n})):a.createElement(g,r({ref:t},s))}));function g(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=h;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[c]="string"==typeof e?e:i,r[1]=l;for(var u=2;u<o;u++)r[u]=n[u];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},5704:function(e,t,n){n.r(t),n.d(t,{assets:function(){return s},contentTitle:function(){return p},default:function(){return h},frontMatter:function(){return l},metadata:function(){return u},toc:function(){return c}});var a=n(7462),i=n(3366),o=(n(7294),n(3905)),r=["components"],l={title:"Authentication",sidebar_label:"Authentication"},p=void 0,u={unversionedId:"guides/python/authentication",id:"guides/python/authentication",title:"Authentication",description:'You can implement user authentication ("Login with X" buttons) in your Flet app using 3rd-party identity providers such as GitHub, Google, Azure, Auth0, LinkedIn and others.',source:"@site/docs/guides/python/authentication.md",sourceDirName:"guides/python",slug:"/guides/python/authentication",permalink:"/docs/guides/python/authentication",draft:!1,editUrl:"https://github.com/flet-dev/website/edit/main/docs/guides/python/authentication.md",tags:[],version:"current",frontMatter:{title:"Authentication",sidebar_label:"Authentication"},sidebar:"docs",previous:{title:"Animations",permalink:"/docs/guides/python/animations"},next:{title:"Client storage",permalink:"/docs/guides/python/client-storage"}},s={},c=[{value:"Login process overview",id:"login-process-overview",level:2},{value:"Configuring OAuth provider",id:"configuring-oauth-provider",level:2},{value:"Sign in with OAuth provider",id:"sign-in-with-oauth-provider",level:2},{value:"Redirect URL",id:"redirect-url",level:3},{value:"Scope",id:"scope",level:3},{value:"Checking authentication results",id:"checking-authentication-results",level:3},{value:"Accessing user details",id:"accessing-user-details",level:2},{value:"Using OAuth token",id:"using-oauth-token",level:2},{value:"Saving and restoring an auth token",id:"saving-and-restoring-an-auth-token",level:2},{value:"Signing out",id:"signing-out",level:2},{value:"Customizing authorization flow",id:"customizing-authorization-flow",level:2},{value:"Configuring a custom OAuth provider",id:"configuring-a-custom-oauth-provider",level:2}],d={toc:c};function h(e){var t=e.components,n=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,'You can implement user authentication ("Login with X" buttons) in your Flet app using 3rd-party identity providers such as GitHub, Google, Azure, Auth0, LinkedIn and others.'),(0,o.kt)("p",null,"Identity provider must support ",(0,o.kt)("a",{parentName:"p",href:"https://auth0.com/docs/get-started/authentication-and-authorization-flow/authorization-code-flow"},"OAuth 2.0 Authorization Code Flow")," to retrieve API access token."),(0,o.kt)("p",null,"Built-in Flet login with credentials and user management is planned for future releases.\nIf you have a requirement to create and manage user accounts in your app you can implement it\nby your own or use ",(0,o.kt)("a",{parentName:"p",href:"https://auth0.com/user-management"},"Auth0")," identity provider which provides\na generous free tier."),(0,o.kt)("p",null,"Flet authentication features:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Works with Flet desktop, web and mobile apps."),(0,o.kt)("li",{parentName:"ul"},"Using multiple authentication providers in one app."),(0,o.kt)("li",{parentName:"ul"},"Built-in OAuth providers with automatic user details fetching:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"GitHub"),(0,o.kt)("li",{parentName:"ul"},"Azure"),(0,o.kt)("li",{parentName:"ul"},"Google"),(0,o.kt)("li",{parentName:"ul"},"Auth0"))),(0,o.kt)("li",{parentName:"ul"},"Optional groups fetching."),(0,o.kt)("li",{parentName:"ul"},"Automatic token refresh."),(0,o.kt)("li",{parentName:"ul"},'Login with a saved token ("Remember me").'),(0,o.kt)("li",{parentName:"ul"},"Custom OAuth providers.")),(0,o.kt)("h2",{id:"login-process-overview"},"Login process overview"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Configure OAuth provider (built-in or generic) with Client ID, Client secret, Redirect URL."),(0,o.kt)("li",{parentName:"ul"},"Call ",(0,o.kt)("inlineCode",{parentName:"li"},"page.login(provider)")," to initiate OAuth web flow."),(0,o.kt)("li",{parentName:"ul"},"User is being redirected to OAuth provider website."),(0,o.kt)("li",{parentName:"ul"},"On provider website user signs in and gives consent to access service API with requested scopes."),(0,o.kt)("li",{parentName:"ul"},"Provider website redirects to Flet's OAuth callback URL with authorization code."),(0,o.kt)("li",{parentName:"ul"},"Flet exchanges authorization code for a token and calls ",(0,o.kt)("inlineCode",{parentName:"li"},"page.on_login")," event handler."),(0,o.kt)("li",{parentName:"ul"},"Flet app can retrieve API token from ",(0,o.kt)("inlineCode",{parentName:"li"},"page.auth.token")," property and user details from ",(0,o.kt)("inlineCode",{parentName:"li"},"page.auth.user"),".")),(0,o.kt)("h2",{id:"configuring-oauth-provider"},"Configuring OAuth provider"),(0,o.kt)("p",null,"Flet has the following built-in OAuth providers:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"GitHub"),(0,o.kt)("li",{parentName:"ul"},"Azure"),(0,o.kt)("li",{parentName:"ul"},"Google"),(0,o.kt)("li",{parentName:"ul"},"Auth0")),(0,o.kt)("p",null,"Additionally, you can configure a generic OAuth provider and provide authorization, token and user info endpoints."),(0,o.kt)("p",null,"In this guide we will configure Flet login page with GitHub account."),(0,o.kt)("p",null,"To integrate Flet authentication with GitHub a new ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/settings/developers"},"GitHub OAuth app")," should be registered first (",(0,o.kt)("strong",{parentName:"p"},"Profile settings")," \u2192 ",(0,o.kt)("strong",{parentName:"p"},"Developer settings")," \u2192 ",(0,o.kt)("strong",{parentName:"p"},"OAuth Apps"),")."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Authorization callback URL")," should be in the format:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"{application-url}/api/oauth/redirect\n")),(0,o.kt)("img",{src:"/img/docs/getting-started/authentication/github-new-oauth-app.png",className:"screenshot-40"}),(0,o.kt)("p",null,'On OAuth app details page click "Generate a new client secret" button.\nCopy "Client ID" and "Client secret" values to a safe place - you\'ll need them in a Flet app.'),(0,o.kt)("img",{src:"/img/docs/getting-started/authentication/github-oauth-app-details.png",className:"screenshot-40"}),(0,o.kt)("h2",{id:"sign-in-with-oauth-provider"},"Sign in with OAuth provider"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'import os\n\nimport flet as ft\nfrom flet.auth.providers.github_oauth_provider import GitHubOAuthProvider\n\ndef main(page: ft.Page):\n\n    provider = GitHubOAuthProvider(\n        client_id=os.getenv("GITHUB_CLIENT_ID"),\n        client_secret=os.getenv("GITHUB_CLIENT_SECRET"),\n        redirect_url="http://localhost:8550/api/oauth/redirect",\n    )\n\n    def login_click(e):\n        page.login(provider)\n\n    def on_login(e):\n        print("Access token:", page.auth.token.access_token)\n        print("User ID:", page.auth.user.id)\n\n    page.on_login = on_login\n    page.add(ft.ElevatedButton("Login with GitHub", on_click=login_click))\n\nft.app(target=main, port=8550, view=ft.AppView.WEB_BROWSER)\n')),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Notice, we are fetching OAuth app client ID and client secret from an environment variables.\nDo not embed any secrets into source code to avoid accidential exposure to a public!")),(0,o.kt)("p",null,"Before running the app set the secret environment variables in a command line:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ export GITHUB_CLIENT_ID="<client_id>"\n$ export GITHUB_CLIENT_SECRET="<client_secret>"\n')),(0,o.kt)("p",null,'Run the program and click "Login with GitHub" button. GitHub authorize app page will be opened in:'),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Desktop")," app - a new browser window or tab."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Web")," app - a new popup window (make sure popup blocker is off)."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Mobile")," app - an in-app web browser.")),(0,o.kt)("img",{src:"/img/docs/getting-started/authentication/github-oauth-authorize.png",className:"screenshot-40"}),(0,o.kt)("h3",{id:"redirect-url"},"Redirect URL"),(0,o.kt)("p",null,"We used ",(0,o.kt)("inlineCode",{parentName:"p"},"http://localhost:8550/api/oauth/redirect")," as a redirect URL while registering GitHub OAuth app.\nNotice it has a fixed port ",(0,o.kt)("inlineCode",{parentName:"p"},"8550"),". To run your Flet app on a fixed port use ",(0,o.kt)("inlineCode",{parentName:"p"},"port")," argument in ",(0,o.kt)("inlineCode",{parentName:"p"},"flet.app")," call:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"ft.app(target=main, port=8550)\n")),(0,o.kt)("h3",{id:"scope"},"Scope"),(0,o.kt)("p",null,"Most of OAuth providers allows applications to request one or more scopes to limit application's access to a\nuser's account."),(0,o.kt)("p",null,"Built-in Flet providers, by default, request scopes to access user profile, but you can request additional scopes in login method, like ",(0,o.kt)("inlineCode",{parentName:"p"},"public_repo")," in the example above:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'page.login(\n    provider,\n    scope=["public_repo"])\n')),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"page.login()")," method has a number of arguments to control authentication process:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"fetch_user")," (bool) - whether to fetch user details into ",(0,o.kt)("inlineCode",{parentName:"li"},"page.auth.user"),". Default is ",(0,o.kt)("inlineCode",{parentName:"li"},"True"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"fetch_groups")," (bool) - whether to fetch user groups into ",(0,o.kt)("inlineCode",{parentName:"li"},"page.auth.user.groups"),". Default is ",(0,o.kt)("inlineCode",{parentName:"li"},"False"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"scope")," - a list of scopes to request."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"saved_token")," - a JSON snapshot of ",(0,o.kt)("inlineCode",{parentName:"li"},"page.auth.token")," to restore authorization from. Token can be serialized with ",(0,o.kt)("inlineCode",{parentName:"li"},"page.auth.token.to_json()"),", enscrypted and saved in ",(0,o.kt)("a",{parentName:"li",href:"/docs/guides/python/client-storage"},(0,o.kt)("inlineCode",{parentName:"a"},"page.client_storage")),". See below."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"on_open_authorization_url")," - a callback to open a browser with authorization URL. See below."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"complete_page_html"),' - a custom HTML contents of "You\'ve been successfully authenticated. Close this page now" page.'),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"redirect_to_page")," (bool) - used with Flet web app only when authorization page is opened in the same browser tab.")),(0,o.kt)("p",null,"The result of ",(0,o.kt)("inlineCode",{parentName:"p"},"page.login()")," call is an instance of ",(0,o.kt)("inlineCode",{parentName:"p"},"Authorization")," class with the following fields:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"strong"},"token"))," - OAuth token used to access provider's API. See below."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"strong"},"user"))," - user details with a mandatory ",(0,o.kt)("inlineCode",{parentName:"li"},"id")," field and other fields specific to OAuth provider."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"strong"},"provider"))," - an instance of OAuth provider used for authorization.")),(0,o.kt)("p",null,"A reference to the last authorization is saved in ",(0,o.kt)("inlineCode",{parentName:"p"},"page.auth")," property."),(0,o.kt)("p",null,"If you app allows authorizations with multiple OAuth providers you can save authorizations in a session,\nfor example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'page.session["github_auth"] = page.login(github_provider)\npage.session["google_auth"] = page.login(google_provider)\n')),(0,o.kt)("h3",{id:"checking-authentication-results"},"Checking authentication results"),(0,o.kt)("p",null,"Upon successful or failed authorization ",(0,o.kt)("inlineCode",{parentName:"p"},"page.on_login")," event handler is called."),(0,o.kt)("p",null,"Event handler argument ",(0,o.kt)("inlineCode",{parentName:"p"},"e")," is an instance of ",(0,o.kt)("inlineCode",{parentName:"p"},"LoginEvent")," class with the following properties:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"error")," (str) - OAuth error."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"error_description")," (str) - OAuth error description.")),(0,o.kt)("p",null,"Authorization was successful if ",(0,o.kt)("inlineCode",{parentName:"p"},"error")," is an empty string."),(0,o.kt)("p",null,"You can use this event handler to toggle signed in/out UI, for example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'import os\n\nimport flet as ft\nfrom flet.auth.providers.github_oauth_provider import GitHubOAuthProvider\n\ndef main(page: ft.Page):\n\n    provider = GitHubOAuthProvider(\n        client_id=os.getenv("GITHUB_CLIENT_ID"),\n        client_secret=os.getenv("GITHUB_CLIENT_SECRET"),\n        redirect_url="http://localhost:8550/api/oauth/redirect",\n    )\n\n    def login_button_click(e):\n        page.login(provider, scope=["public_repo"])\n\n    def on_login(e: ft.LoginEvent):\n        if not e.error:\n            toggle_login_buttons()\n\n    def logout_button_click(e):\n        page.logout()\n\n    def on_logout(e):\n        toggle_login_buttons()\n\n    def toggle_login_buttons():\n        login_button.visible = page.auth is None\n        logout_button.visible = page.auth is not None\n        page.update()\n\n    login_button = ft.ElevatedButton("Login with GitHub", on_click=login_button_click)\n    logout_button = ft.ElevatedButton("Logout", on_click=logout_button_click)\n    toggle_login_buttons()\n    page.on_login = on_login\n    page.on_logout = on_logout\n    page.add(login_button, logout_button)\n\nft.app(target=main, port=8550, view=ft.AppView.WEB_BROWSER)\n')),(0,o.kt)("h2",{id:"accessing-user-details"},"Accessing user details"),(0,o.kt)("p",null,"If ",(0,o.kt)("inlineCode",{parentName:"p"},"page.login()")," method is called with ",(0,o.kt)("inlineCode",{parentName:"p"},"fetch_user=True")," (default) a user profile will\nbe assigned to ",(0,o.kt)("inlineCode",{parentName:"p"},"page.auth.user"),"."),(0,o.kt)("p",null,"All built-in OAuth providers implement ",(0,o.kt)("inlineCode",{parentName:"p"},"user.id")," property - unique user identifier - which value depends\non the provider (a number, Guid or email) and can be used in your app as a user key."),(0,o.kt)("p",null,"The rest of user profile properties depends on provider and can be accessed with an indexer.\nFor example, to print some properties of GitHub user:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'print("Name:", page.auth.user["name"])\nprint("Login:", page.auth.user["login"])\nprint("Email:", page.auth.user["email"])\n')),(0,o.kt)("h2",{id:"using-oauth-token"},"Using OAuth token"),(0,o.kt)("p",null,"Upon successful authorization ",(0,o.kt)("inlineCode",{parentName:"p"},"page.auth.token")," will contain OAuth token that can be used to access providers's API. Token object has the following properties:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"access_token")," - access token used as an authorization token in API request header."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"scope")," - token's scope."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"token_type")," - access token type, e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},"Bearer"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"expires_in")," - optional number of seconds when access token expires."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"expires_at")," - optional time (",(0,o.kt)("inlineCode",{parentName:"li"},"time.time()")," + ",(0,o.kt)("inlineCode",{parentName:"li"},"expires_in"),") when access token expires."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"refresh_token")," - optional refresh token which is used to get a new access token, when the old one expires.")),(0,o.kt)("p",null,"Usually, only ",(0,o.kt)("inlineCode",{parentName:"p"},"page.auth.token.access_token")," is needed to call provider's API,\nfor example to list user's GitHub repositories:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'import requests\nheaders = {"Authorization": "Bearer {}".format(page.auth.token.access_token)}\nrepos_resp = requests.get("https://api.github.com/user/repos", headers=headers)\nuser_repos = json.loads(repos_resp.text)\nfor repo in user_repos:\n    print(repo["full_name"])\n')),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Do not save a reference to ",(0,o.kt)("inlineCode",{parentName:"p"},"page.auth.token")," somewhere in your code, but rather call ",(0,o.kt)("inlineCode",{parentName:"p"},"page.auth.token"),"\nevery time you need to grab access token. ",(0,o.kt)("inlineCode",{parentName:"p"},"page.auth.token")," is a property which automatically refreshes\nOAuth token if/when it expires."),(0,o.kt)("p",{parentName:"admonition"},"Correct code:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-python"},"access_token = page.auth.token.access_token\n")),(0,o.kt)("p",{parentName:"admonition"},"Wrong code:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-python"},"token = page.auth.token\n# some other code\naccess_token = token.access_token # token could expire by this moment\n"))),(0,o.kt)("h2",{id:"saving-and-restoring-an-auth-token"},"Saving and restoring an auth token"),(0,o.kt)("p",null,'To implement persistent login ("Remember me" checkbox on login page) you can save auth token in a ',(0,o.kt)("a",{parentName:"p",href:"/docs/guides/python/client-storage"},"client storage")," and use it to login next time a user opens your Flet app."),(0,o.kt)("p",null,"To serialize auth token to JSON:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"jt = page.auth.token.to_json()\n")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Encrypt sensitive data before sending it to a client storage.")),(0,o.kt)("p",null,"Flet includes utility methods for encrypting text data using symmetric algorithm (where the same key is used for encryption and decryption). They use ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/fernet/spec/blob/master/Spec.md"},"Fernet")," implementation from ",(0,o.kt)("a",{parentName:"p",href:"https://pypi.org/project/cryptography/"},"cryptography")," package, which is AES 128 with some additional hardening, plus PBKDF2 to derive encryption key from a user passphrase."),(0,o.kt)("p",null,"To encrypt JSON token:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'import os\nfrom flet.security import encrypt, decrypt\n\nsecret_key = os.getenv("MY_APP_SECRET_KEY")\n# returns base64-encoded string\nejt = encrypt(jt, secret_key)\n')),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Notice, we are fetching a secret key (aka passphrase, password, etc.) from an environment variable.\nDo not embed any secrets into source code to avoid accidential exposure to a public!")),(0,o.kt)("p",null,"Before running the app set the secret in a command line:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ export MY_APP_SECRET_KEY="<secret>"\n')),(0,o.kt)("p",null,"Now, encrypted value can be stored in a client storage:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'page.client_storage.set("myapp.auth_token", ejt)\n')),(0,o.kt)("p",null,"Next time a user opens the app you can read encrypted token from a client storage and, if it exists,\ndecrypt it and use in ",(0,o.kt)("inlineCode",{parentName:"p"},"page.login()")," method:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'ejt = page.client_storage.get("myapp.auth_token")\nif ejt:\n    jt = decrypt(ejt, secret_key)\n    page.login(provider, saved_token=jt)\n')),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/flet-dev/examples/blob/main/python/apps/authentication/github-oauth-with-listing-repos.py"},"See complete app example"),"."),(0,o.kt)("h2",{id:"signing-out"},"Signing out"),(0,o.kt)("p",null,"Calling ",(0,o.kt)("inlineCode",{parentName:"p"},"page.logout()")," resets ",(0,o.kt)("inlineCode",{parentName:"p"},"page.auth")," reference and triggers ",(0,o.kt)("inlineCode",{parentName:"p"},"page.on_logout")," event handlers."),(0,o.kt)("p",null,"You can remove saved token in logout method, for example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"def logout_button_click(e):\n    page.client_storage.remove(AUTH_TOKEN_KEY)\n    page.logout()\n")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/flet-dev/examples/blob/main/python/apps/authentication/github-oauth-with-listing-repos.py"},"See complete app example"),"."),(0,o.kt)("h2",{id:"customizing-authorization-flow"},"Customizing authorization flow"),(0,o.kt)("p",null,"By default, OAuth authorization flow is happening in either new browser window/tab (desktop app), browser popup window (web) or in-app web view (mobile)."),(0,o.kt)("p",null,"Upon completion of authorization flow a user is redirected to Flet's OAuth callback page (",(0,o.kt)("inlineCode",{parentName:"p"},"/api/oauth/redirect"),") which tries to close a browser window/tab with JavaScript and provides user with instructions to close the window manually if JavaScript close didn't work."),(0,o.kt)("p",null,"This section is applicable to Flet desktop and web apps only as in-app web view in mobile apps can be closed by Flet without relying on JavaScript."),(0,o.kt)("p",null,'You can customize the contents of "Authorization complete" page in ',(0,o.kt)("inlineCode",{parentName:"p"},"page.login()")," method, for example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'complete_page_html = """\n<!DOCTYPE html>\n<html>\n  <head>\n    <title>Signed in to MyApp</title>\n  </head>\n<body>\n  <script type="text/javascript">\n      window.close();\n  <\/script>\n  <p>You\'ve been successfully signed in! You can close this tab or window now.</p>\n</body>\n</html>\n"""\n\npage.login(\n    provider,\n    complete_page_html=complete_page_html,\n)\n')),(0,o.kt)("p",null,"You can also change web app to open provider's authorization page in the same tab which might be more familiar to your users and save them from dealing with popup blockers:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'page.login(\n    provider,\n    on_open_authorization_url=lambda url: page.launch_url(url, web_window_name="_self"),\n    redirect_to_page=True\n)\n')),(0,o.kt)("p",null,"To open flow in a new tab (notice ",(0,o.kt)("inlineCode",{parentName:"p"},"_self")," replaced with ",(0,o.kt)("inlineCode",{parentName:"p"},"_blank"),"):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'page.login(\n    provider,\n    on_open_authorization_url=lambda url: page.launch_url(url, web_window_name="_blank")\n)\n')),(0,o.kt)("h2",{id:"configuring-a-custom-oauth-provider"},"Configuring a custom OAuth provider"),(0,o.kt)("p",null,"You can configure any OAuth-compatible authentication provider in your app with ",(0,o.kt)("inlineCode",{parentName:"p"},"flet.auth.oauth_provider.OAuthProvider")," class."),(0,o.kt)("p",null,"Following the instructions in ",(0,o.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/linkedin/shared/authentication/authorization-code-flow?context=linkedin%2Fcontext&tabs=HTTPS"},"LinkedIn Authorization Code Flow guide")," we are able\nto get all required parameters to configure LinkedIn OAuth provider to allow users of your Flet app to login\nwith their LinkedIn accounts:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python",metastring:"{9-18}","{9-18}":!0},'import os\n\nimport flet as ft\nfrom flet.auth.oauth_provider import OAuthProvider\n\ndef main(page: ft.Page):\n\n    provider = OAuthProvider(\n        client_id=os.getenv("LINKEDIN_CLIENT_ID"),\n        client_secret=os.getenv("LINKEDIN_CLIENT_SECRET"),\n        authorization_endpoint="https://www.linkedin.com/oauth/v2/authorization",\n        token_endpoint="https://www.linkedin.com/oauth/v2/accessToken",\n        redirect_url="http://localhost:8550/api/oauth/redirect",\n        user_endpoint="https://api.linkedin.com/v2/me",\n        user_scopes=["r_liteprofile", "r_emailaddress"],\n        user_id_fn=lambda u: u["id"]\n    )\n\n    def login_click(e):\n        page.login(provider)\n\n    def on_login(e):\n        if e.error:\n            raise Exception(e.error)\n        print("User ID:", page.auth.user.id)\n        print("Access token:", page.auth.token.access_token)\n\n    page.on_login = on_login\n    page.add(ft.ElevatedButton("Login with LinkedIn", on_click=login_click))\n\nft.app(target=main, port=8550, view=ft.AppView.WEB_BROWSER)\n')),(0,o.kt)("p",null,"Mandatory provider settings:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"client_id")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"client_secret")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"authorization_endpoint")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"token_endpoint")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"redirect_url"))),(0,o.kt)("p",null,"Similar to other examples client ID and client secret are fetched from environment variables."))}h.isMDXComponent=!0}}]);