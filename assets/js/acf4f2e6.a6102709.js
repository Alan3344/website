"use strict";(self.webpackChunkflet_dev=self.webpackChunkflet_dev||[]).push([[7081],{3905:function(e,t,a){a.d(t,{Zo:function(){return u},kt:function(){return h}});var n=a(7294);function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){s(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,s=function(e,t){if(null==e)return{};var a,n,s={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(s[a]=e[a]);return s}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(s[a]=e[a])}return s}var r=n.createContext({}),p=function(e){var t=n.useContext(r),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(r.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,s=e.mdxType,o=e.originalType,r=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),c=p(a),d=s,h=c["".concat(r,".").concat(d)]||c[d]||m[d]||o;return a?n.createElement(h,l(l({ref:t},u),{},{components:a})):n.createElement(h,l({ref:t},u))}));function h(e,t){var a=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var o=a.length,l=new Array(o);l[0]=d;var i={};for(var r in t)hasOwnProperty.call(t,r)&&(i[r]=t[r]);i.originalType=e,i[c]="string"==typeof e?e:s,l[1]=i;for(var p=2;p<o;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},7835:function(e,t,a){a.r(t),a.d(t,{assets:function(){return u},contentTitle:function(){return r},default:function(){return d},frontMatter:function(){return i},metadata:function(){return p},toc:function(){return c}});var n=a(7462),s=a(3366),o=(a(7294),a(3905)),l=["components"],i={title:"Creating realtime chat app in Python",sidebar_label:"Python - Realtime Chat app"},r=void 0,p={unversionedId:"tutorials/python-realtime-chat",id:"tutorials/python-realtime-chat",title:"Creating realtime chat app in Python",description:"In this tutorial we are going to create a trivial in-memory Chat app that will help you understand Flet framework basics. This app could be a good starting point to creating your own more complex and useful projects.",source:"@site/docs/tutorials/python-realtime-chat.md",sourceDirName:"tutorials",slug:"/tutorials/python-realtime-chat",permalink:"/website/docs/tutorials/python-realtime-chat",draft:!1,editUrl:"https://github.com/flet-dev/website/edit/main/docs/tutorials/python-realtime-chat.md",tags:[],version:"current",frontMatter:{title:"Creating realtime chat app in Python",sidebar_label:"Python - Realtime Chat app"},sidebar:"docs",previous:{title:"Python - Solitaire game",permalink:"/website/docs/tutorials/python-solitaire"},next:{title:"Controls reference",permalink:"/website/docs/controls"}},u={},c=[{value:"Getting started with Flet",id:"getting-started-with-flet",level:2},{value:"Adding page controls and handling events",id:"adding-page-controls-and-handling-events",level:2},{value:"Broadcasting chat messages",id:"broadcasting-chat-messages",level:2},{value:"User name dialog",id:"user-name-dialog",level:2},{value:"Enhancing user interface",id:"enhancing-user-interface",level:2},{value:"Re-usable user controls",id:"re-usable-user-controls",level:3},{value:"Laying out controls",id:"laying-out-controls",level:3},{value:"Keyboard support",id:"keyboard-support",level:3},{value:"Focusing input controls",id:"focusing-input-controls",level:4},{value:"Submitting forms on <code>Enter</code>",id:"submitting-forms-on-enter",level:4},{value:"Entering multiline messages",id:"entering-multiline-messages",level:4},{value:"Animated scrolling to the last message",id:"animated-scrolling-to-the-last-message",level:3},{value:"Page title",id:"page-title",level:3},{value:"Deploying the app",id:"deploying-the-app",level:2},{value:"What&#39;s next",id:"whats-next",level:2},{value:"Summary",id:"summary",level:2}],m={toc:c};function d(e){var t=e.components,a=(0,s.Z)(e,l);return(0,o.kt)("wrapper",(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"In this tutorial we are going to create a trivial in-memory Chat app that will help you understand Flet framework basics. This app could be a good starting point to creating your own more complex and useful projects."),(0,o.kt)("p",null,"In this tutorial you will learn how to:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#getting-started-with-flet"},"Create your first Flet app")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#adding-page-controls-and-handling-events"},"Add page controls and handle events")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#broadcasting-chat-messages"},"Broadcast messages using built-in PubSub library")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#user-name-dialog"},"Use AlertDialog control for accepting user name")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#enhancing-user-interface"},"Enhance user interface with re-usable controls")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#deploying-the-app"},"Deploy the app as a web app")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#progressive-web-app-pwa"},"Deliver the app as a Progressive Web App (PWA)"))),(0,o.kt)("p",null,"The complete application will look like this:"),(0,o.kt)("img",{src:"/img/docs/chat-tutorial/chat.gif",className:"screenshot-50"}),(0,o.kt)("p",null,"You can play with a live demo ",(0,o.kt)("a",{parentName:"p",href:"https://flet-chat.fly.dev"},"here"),"."),(0,o.kt)("p",null,"The full code for the chat app can be found ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/flet-dev/examples/blob/main/python/tutorials/chat/chat.py"},"here"),"."),(0,o.kt)("h2",{id:"getting-started-with-flet"},"Getting started with Flet"),(0,o.kt)("p",null,'It\'s a tradition to start with "Hello, world!" app!'),(0,o.kt)("p",null,"Flet requires Python 3.7 or above. To create a Flet app in Python, you need to install ",(0,o.kt)("inlineCode",{parentName:"p"},"flet")," module first:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"pip install flet\n")),(0,o.kt)("admonition",{title:"Upgrading Flet",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"To upgrade ",(0,o.kt)("inlineCode",{parentName:"p"},"flet")," module run:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"pip install flet --upgrade\n"))),(0,o.kt)("p",null,"Create ",(0,o.kt)("inlineCode",{parentName:"p"},"hello.py")," with the following contents:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="hello.py"',title:'"hello.py"'},'import flet as ft\n\ndef main(page: ft.Page):\n    page.add(ft.Text(value="Hello, world!"))\n\nft.app(target=main)\n')),(0,o.kt)("p",null,"Run this app and you will see a new window with a greeting:"),(0,o.kt)("img",{src:"/img/docs/tutorial/todo-app-hello-world.png",className:"screenshot-40"}),(0,o.kt)("h2",{id:"adding-page-controls-and-handling-events"},"Adding page controls and handling events"),(0,o.kt)("p",null,"To start, we want to be able to take user input (chat message) and show messages history on the screen. The layout for this step could look like this:"),(0,o.kt)("img",{src:"/img/docs/chat-tutorial/chat-layout-1.svg",className:"screenshot-70"}),(0,o.kt)("p",null,"To implement this layout we will be using these Flet controls:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/controls/column"},"Column")," - a container to display chat messages (Text controls) vertically."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/controls/text"},"Text")," - chat message displayed in the chat Column."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/controls/textfield"},"TextField")," - input control used for taking new message input from the user."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/controls/elevatedbutton"},"ElevatedButton"),' - "Send" button that will add new message to the chat Column.'),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/controls/row"},"Row")," - a container to display TextField and ElevatedButton horizontally.")),(0,o.kt)("p",null,"Create ",(0,o.kt)("inlineCode",{parentName:"p"},"chat.py")," with the following contents:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'import flet as ft\n\ndef main(page: ft.Page):\n    chat = ft.Column()\n    new_message = ft.TextField()\n\n    def send_click(e):\n        chat.controls.append(ft.Text(new_message.value))\n        new_message.value = ""\n        page.update()\n\n    page.add(\n        chat, ft.Row(controls=[new_message, ft.ElevatedButton("Send", on_click=send_click)])\n    )\n\nft.app(main, view=ft.AppView.WEB_BROWSER)\n')),(0,o.kt)("p",null,'When user clicks on the "Send" button, it triggers ',(0,o.kt)("inlineCode",{parentName:"p"},"on_click")," event which calls ",(0,o.kt)("inlineCode",{parentName:"p"},"send_click")," method. ",(0,o.kt)("inlineCode",{parentName:"p"},"send_click")," then adds new ",(0,o.kt)("inlineCode",{parentName:"p"},"Text")," control to the list of Column ",(0,o.kt)("inlineCode",{parentName:"p"},"controls")," and clears ",(0,o.kt)("inlineCode",{parentName:"p"},"new_message")," TextField value."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"After any properties of a control are updated, an ",(0,o.kt)("inlineCode",{parentName:"p"},"update()")," method of the control (or its parent control) should be called for the update to take effect.")),(0,o.kt)("p",null,"Chat app now looks like this:"),(0,o.kt)("img",{src:"/img/docs/chat-tutorial/chat-1.png",className:"screenshot-40"}),(0,o.kt)("h2",{id:"broadcasting-chat-messages"},"Broadcasting chat messages"),(0,o.kt)("p",null,"In the previous step we have created a simple web app that takes input from the user and displays chats messages on the screen. If you open this app in two web browser tabs, it will create two app sessions. Each session will have its own list of messages."),(0,o.kt)("p",null,"To build a realtime chat app, you need to somehow pass the messages between chat app sessions. When a user sends a message, it should be broadcasted to all other app sessions and displayed on their pages."),(0,o.kt)("p",null,"Flet provides a simple built-in ",(0,o.kt)("a",{parentName:"p",href:"/docs/guides/python/pub-sub"},"PubSub")," mechanism for asynchronous communication between page sessions."),(0,o.kt)("p",null,"First, we need subscribe the user to receive broadcast messages:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"    page.pubsub.subscribe(on_message)\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"pubsub.subsribe()")," method will add current app session to the list of subscribers. It accepts ",(0,o.kt)("inlineCode",{parentName:"p"},"handler")," as an argument, that will later be called at the moment a publisher calls ",(0,o.kt)("inlineCode",{parentName:"p"},"pubsub.send_all()")," method."),(0,o.kt)("p",null,"In the ",(0,o.kt)("inlineCode",{parentName:"p"},"handler")," we will be adding new message (",(0,o.kt)("inlineCode",{parentName:"p"},"Text"),") to the list of chat ",(0,o.kt)("inlineCode",{parentName:"p"},"controls"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'    def on_message(message: Message):\n        chat.controls.append(ft.Text(f"{message.user}: {message.text}"))\n        page.update()\n')),(0,o.kt)("p",null,"Finally, you need to call ",(0,o.kt)("inlineCode",{parentName:"p"},"pubsub.send_all()"),' method when the user clicks on "Send" button:'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'    def send_click(e):\n        page.pubsub.send_all(Message(user=page.session_id, text=new_message.value))\n        new_message.value = ""\n        page.update()\n\n    page.add(chat, ft.Row([new_message, ft.ElevatedButton("Send", on_click=send_click)]))   \n')),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"pubsub.send_all()")," will call the ",(0,o.kt)("inlineCode",{parentName:"p"},"on_message()")," and pass on the Message object down to it."),(0,o.kt)("p",null,"Here is the full code for this step:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'import flet as ft\n\nclass Message():\n    def __init__(self, user: str, text: str):\n        self.user = user\n        self.text = text\n\ndef main(page: ft.Page):\n\n    chat = ft.Column()\n    new_message = ft.TextField()\n\n    def on_message(message: Message):\n        chat.controls.append(ft.Text(f"{message.user}: {message.text}"))\n        page.update()\n\n    page.pubsub.subscribe(on_message)\n\n    def send_click(e):\n        page.pubsub.send_all(Message(user=page.session_id, text=new_message.value))\n        new_message.value = ""\n        page.update()\n\n    page.add(chat, ft.Row([new_message, ft.ElevatedButton("Send", on_click=send_click)]))\n\nft.app(target=main, view=ft.AppView.WEB_BROWSER)\n')),(0,o.kt)("img",{src:"/img/docs/chat-tutorial/chat-2.gif",className:"screenshot-100"}),(0,o.kt)("h2",{id:"user-name-dialog"},"User name dialog"),(0,o.kt)("p",null,"Chat app that you have created in the previous step has basic functionality needed to exchange messages between user sessions. It is not very user-friendly though, since it shows ",(0,o.kt)("inlineCode",{parentName:"p"},"session_id")," that sent a message, which doesn't tell much about who you are communicating with. "),(0,o.kt)("p",null,"Let's improve our app to show user name instead of ",(0,o.kt)("inlineCode",{parentName:"p"},"session_id")," for each message. To capture user name, we will be using ",(0,o.kt)("a",{parentName:"p",href:"/docs/controls/alertdialog"},(0,o.kt)("inlineCode",{parentName:"a"},"AlertDialog"))," control. Let's add it to the page:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'    user_name = ft.TextField(label="Enter your name")\n\n    page.dialog = ft.AlertDialog(\n        open=True,\n        modal=True,\n        title=ft.Text("Welcome!"),\n        content=ft.Column([user_name], tight=True),\n        actions=[ft.ElevatedButton(text="Join chat", on_click=join_click)],\n        actions_alignment="end",\n    )\n')),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"A dialog will be opened on the start of the program since we have set its ",(0,o.kt)("inlineCode",{parentName:"p"},"open")," property to ",(0,o.kt)("inlineCode",{parentName:"p"},"True"),".")),(0,o.kt)("img",{src:"/img/docs/chat-tutorial/username-dialog.png",className:"screenshot-40"}),(0,o.kt)("p",null,'When the user clicks on "Join chat" button, it will call ',(0,o.kt)("inlineCode",{parentName:"p"},"join_click")," method that should send a message to all subscribers, informing them that the user has joined the chat. This message should look different from the regular chat message, for example, like this:"),(0,o.kt)("img",{src:"/img/docs/chat-tutorial/chat-4.png",className:"screenshot-40"}),(0,o.kt)("p",null,"Let's add ",(0,o.kt)("inlineCode",{parentName:"p"},"message_type")," property to the ",(0,o.kt)("inlineCode",{parentName:"p"},"Message")," class to differentiate between login and chat messages:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"class Message():\n    def __init__(self, user: str, text: str, message_type: str):\n        self.user = user\n        self.text = text\n        self.message_type = message_type\n")),(0,o.kt)("p",null,"We will be checking ",(0,o.kt)("inlineCode",{parentName:"p"},"message_type")," in ",(0,o.kt)("inlineCode",{parentName:"p"},"on_message")," method:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'def on_message(message: Message):\n    if message.message_type == "chat_message":\n        chat.controls.append(ft.Text(f"{message.user}: {message.text}"))\n    elif message.message_type == "login_message":\n        chat.controls.append(\n            ft.Text(message.text, italic=True, color=ft.colors.BLACK45, size=12)\n        )\n    page.update()\n')),(0,o.kt)("p",null,'Messages of "login_message" and "chat_message" types will now be sent on two events: when user joins the chat and when user sends a message. '),(0,o.kt)("p",null,"Let's create ",(0,o.kt)("inlineCode",{parentName:"p"},"join_click")," method:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'def join_click(e):\n    if not user_name.value:\n        user_name.error_text = "Name cannot be blank!"\n        user_name.update()\n    else:\n        page.session.set("user_name", user_name.value)\n        page.dialog.open = False\n        page.pubsub.send_all(Message(user=user_name.value, text=f"{user_name.value} has joined the chat.", message_type="login_message"))\n        page.update()\n')),(0,o.kt)("p",null,"We used ",(0,o.kt)("a",{parentName:"p",href:"/docs/guides/python/session-storage"},"page session storage")," to store user_name for its future use in ",(0,o.kt)("inlineCode",{parentName:"p"},"send_click")," method to send chat messages."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"User name dialog will close as soon as we set its ",(0,o.kt)("inlineCode",{parentName:"p"},"open")," property to ",(0,o.kt)("inlineCode",{parentName:"p"},"False")," and call ",(0,o.kt)("inlineCode",{parentName:"p"},"update()")," method. ")),(0,o.kt)("p",null,"Finally, let's update ",(0,o.kt)("inlineCode",{parentName:"p"},"send_click")," method to use ",(0,o.kt)("inlineCode",{parentName:"p"},"user_name")," that we previosly saved using ",(0,o.kt)("inlineCode",{parentName:"p"},"page.session"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'def send_click(e):\n    page.pubsub.send_all(Message(user=page.session.get(\'user_name\'), text=new_message.value, message_type="chat_message"))\n    new_message.value = ""\n    page.update()\n')),(0,o.kt)("p",null,"The full code for this step can be found ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/flet-dev/examples/blob/main/python/tutorials/chat/chat_3.py"},"here"),"."),(0,o.kt)("img",{src:"/img/docs/chat-tutorial/chat-3.gif",className:"screenshot-100"}),(0,o.kt)("h2",{id:"enhancing-user-interface"},"Enhancing user interface"),(0,o.kt)("p",null,"Chat app that you have created in the previous step already serves its purpose of exchanging messages between users with basic login functionality. "),(0,o.kt)("p",null,"Before moving on to ",(0,o.kt)("a",{parentName:"p",href:"#deploying-the-app"},"deploying your app"),", we suggest adding some extra features to it that will improve user experience and make the app look more professional."),(0,o.kt)("h3",{id:"re-usable-user-controls"},"Re-usable user controls"),(0,o.kt)("p",null,"You may want to show messages in a different format, like this:"),(0,o.kt)("img",{src:"/img/docs/chat-tutorial/chat-layout-chatmessage.svg",className:"screenshot-70"}),(0,o.kt)("p",null,"Chat message will now be a ",(0,o.kt)("inlineCode",{parentName:"p"},"Row")," containing ",(0,o.kt)("a",{parentName:"p",href:"/docs/controls/circleavatar"},(0,o.kt)("inlineCode",{parentName:"a"},"CircleAvatar"))," with username initials and ",(0,o.kt)("inlineCode",{parentName:"p"},"Column")," that contains two ",(0,o.kt)("inlineCode",{parentName:"p"},"Text")," controls: user name and message text."),(0,o.kt)("p",null,"We will need to show quite a few chat messages in the chat app, so it makes sense to create your own reusable control. Lets create a new ",(0,o.kt)("inlineCode",{parentName:"p"},"ChatMessage")," class that will inherit from ",(0,o.kt)("inlineCode",{parentName:"p"},"Row"),"."),(0,o.kt)("p",null,"When creating an instance of ",(0,o.kt)("inlineCode",{parentName:"p"},"ChatMessage")," class, we will pass a ",(0,o.kt)("inlineCode",{parentName:"p"},"Message")," object as an argument and then ",(0,o.kt)("inlineCode",{parentName:"p"},"ChatMessage")," will display itself based on ",(0,o.kt)("inlineCode",{parentName:"p"},"message.user_name")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"message.text"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'class ChatMessage(ft.Row):\n    def __init__(self, message: Message):\n        super().__init__()\n        self.vertical_alignment="start"\n        self.controls=[\n                ft.CircleAvatar(\n                    content=ft.Text(self.get_initials(message.user_name)),\n                    color=ft.colors.WHITE,\n                    bgcolor=self.get_avatar_color(message.user_name),\n                ),\n                ft.Column(\n                    [\n                        ft.Text(message.user_name, weight="bold"),\n                        ft.Text(message.text, selectable=True),\n                    ],\n                    tight=True,\n                    spacing=5,\n                ),\n            ]\n\n    def get_initials(self, user_name: str):\n        return user_name[:1].capitalize()\n\n    def get_avatar_color(self, user_name: str):\n        colors_lookup = [\n            ft.colors.AMBER,\n            ft.colors.BLUE,\n            ft.colors.BROWN,\n            ft.colors.CYAN,\n            ft.colors.GREEN,\n            ft.colors.INDIGO,\n            ft.colors.LIME,\n            ft.colors.ORANGE,\n            ft.colors.PINK,\n            ft.colors.PURPLE,\n            ft.colors.RED,\n            ft.colors.TEAL,\n            ft.colors.YELLOW,\n        ]\n        return colors_lookup[hash(user_name) % len(colors_lookup)]\n\n')),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"ChatMessage")," control extracts initials and algorithmically derives avatar color from a username.\nLater, if you decide to improve control layout or its logic, it won't affect the rest of the program - that's the power of encapsulation!"),(0,o.kt)("h3",{id:"laying-out-controls"},"Laying out controls"),(0,o.kt)("p",null,"Now you can use your brand new ",(0,o.kt)("inlineCode",{parentName:"p"},"ChatMessage")," to build a better layout for the chat app:"),(0,o.kt)("img",{src:"/img/docs/chat-tutorial/chat-layout-2.svg",className:"screenshot-70"}),(0,o.kt)("p",null,"Instances of ",(0,o.kt)("inlineCode",{parentName:"p"},"ChatMessage")," will be created instead of plain ",(0,o.kt)("inlineCode",{parentName:"p"},"Text")," chat messages in ",(0,o.kt)("inlineCode",{parentName:"p"},"on_message")," method:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'    def on_message(message: Message):\n        if message.message_type == "chat_message":\n            m = ChatMessage(message)\n        elif message.message_type == "login_message":\n            m = ft.Text(message.text, italic=True, color=ft.colors.BLACK45, size=12)\n        chat.controls.append(m)\n        page.update()\n')),(0,o.kt)("p",null,"Other improvements suggested with the new layout are:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/controls/listview"},(0,o.kt)("inlineCode",{parentName:"a"},"ListView"))," instead of ",(0,o.kt)("inlineCode",{parentName:"li"},"Column")," for displaying messages, to be able to scroll through the messages later"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Container")," for displaing border around ",(0,o.kt)("inlineCode",{parentName:"li"},"ListView")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/controls/iconbutton"},(0,o.kt)("inlineCode",{parentName:"a"},"IconButton"))," instead of ",(0,o.kt)("inlineCode",{parentName:"li"},"ElevatedButton")," to send messages"),(0,o.kt)("li",{parentName:"ul"},"Use of ",(0,o.kt)("a",{parentName:"li",href:"/docs/controls#expand"},(0,o.kt)("inlineCode",{parentName:"a"},"expand"))," property for controls to fill available space")),(0,o.kt)("p",null,"Here is how you can implement this layout:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'    # Chat messages\n    chat = ft.ListView(\n        expand=True,\n        spacing=10,\n        auto_scroll=True,\n    )\n\n    # A new message entry form\n    new_message = ft.TextField(\n        hint_text="Write a message...",\n        autofocus=True,\n        shift_enter=True,\n        min_lines=1,\n        max_lines=5,\n        filled=True,\n        expand=True,\n        on_submit=send_message_click,\n    )\n\n    # Add everything to the page\n    page.add(\n        ft.Container(\n            content=chat,\n            border=ft.border.all(1, ft.colors.OUTLINE),\n            border_radius=5,\n            padding=10,\n            expand=True,\n        ),\n        ft.Row(\n            [\n                new_message,\n                ft.IconButton(\n                    icon=ft.icons.SEND_ROUNDED,\n                    tooltip="Send message",\n                    on_click=send_message_click,\n                ),\n            ]\n        ),\n    )\n')),(0,o.kt)("p",null,"The full code for this step can be found ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/flet-dev/examples/blob/main/python/tutorials/chat/chat.py"},"here"),"."),(0,o.kt)("p",null,"This is the final version of the chat app for the purpose of this tutorial. Below you can read more about the enhancements that we have made."),(0,o.kt)("h3",{id:"keyboard-support"},"Keyboard support"),(0,o.kt)("h4",{id:"focusing-input-controls"},"Focusing input controls"),(0,o.kt)("p",null,"All data entry controls have ",(0,o.kt)("inlineCode",{parentName:"p"},"autofocus")," property which when set to ",(0,o.kt)("inlineCode",{parentName:"p"},"True")," moves initial focus to the control. If there is more than one control on a page with ",(0,o.kt)("inlineCode",{parentName:"p"},"autofocus")," set, then the first one added to the page will get focus."),(0,o.kt)("p",null,"We set ",(0,o.kt)("inlineCode",{parentName:"p"},"autofocus=True")," on a username TextField inside a dialog and then on a TextField for entering chat message to set initial focus on it when the dialog is closed."),(0,o.kt)("p",null,'When a user click "Send" button or presses Enter to submit a chat message, TextField loses focus.\nTo programmatically set control focus we used ',(0,o.kt)("a",{parentName:"p",href:"/docs/controls/textfield#focus"},(0,o.kt)("inlineCode",{parentName:"a"},"TextField.focus()"))," method."),(0,o.kt)("h4",{id:"submitting-forms-on-enter"},"Submitting forms on ",(0,o.kt)("inlineCode",{parentName:"h4"},"Enter")),(0,o.kt)("p",null,"It's so tempting to submit forms with just pushing ",(0,o.kt)("inlineCode",{parentName:"p"},"Enter")," button on the keyboard! Type your name in the dialog, hit ",(0,o.kt)("inlineCode",{parentName:"p"},"Enter"),", type a new message, hit ",(0,o.kt)("inlineCode",{parentName:"p"},"Enter"),", type another, hit ",(0,o.kt)("inlineCode",{parentName:"p"},"Enter")," - no mouse involved at all! \ud83d\ude80"),(0,o.kt)("p",null,"Flet has support for that by providing ",(0,o.kt)("a",{parentName:"p",href:"/docs/controls/textfield#on_submit"},(0,o.kt)("inlineCode",{parentName:"a"},"TextField.on_submit"))," event handler which fires when a user press ",(0,o.kt)("inlineCode",{parentName:"p"},"Enter")," button while the focus is on the TextField."),(0,o.kt)("h4",{id:"entering-multiline-messages"},"Entering multiline messages"),(0,o.kt)("p",null,"What about multiline TextFields where ",(0,o.kt)("inlineCode",{parentName:"p"},"Enter")," must advance a cursor to the next line? We've got that covered too! ",(0,o.kt)("inlineCode",{parentName:"p"},"TextField")," control has ",(0,o.kt)("a",{parentName:"p",href:"/docs/controls/textfield#shift_enter"},(0,o.kt)("inlineCode",{parentName:"a"},"shift_enter"))," property which when set to ",(0,o.kt)("inlineCode",{parentName:"p"},"True")," enables Discord-like behavior: to get to a new line user presses ",(0,o.kt)("inlineCode",{parentName:"p"},"Shift"),"+",(0,o.kt)("inlineCode",{parentName:"p"},"Enter")," while hitting just ",(0,o.kt)("inlineCode",{parentName:"p"},"Enter")," submits a form."),(0,o.kt)("h3",{id:"animated-scrolling-to-the-last-message"},"Animated scrolling to the last message"),(0,o.kt)("p",null,"Noticed a nice animation of scrolling to the last message in a chat window? It could be enabled by setting ",(0,o.kt)("a",{parentName:"p",href:"/docs/controls/listview#auto_scroll"},(0,o.kt)("inlineCode",{parentName:"a"},"ListView.auto_scroll"))," property to ",(0,o.kt)("inlineCode",{parentName:"p"},"True"),". The top most ",(0,o.kt)("inlineCode",{parentName:"p"},"Page")," class, being a scrollable container itself, also supports ",(0,o.kt)("a",{parentName:"p",href:"/docs/controls/page#auto_scroll"},(0,o.kt)("inlineCode",{parentName:"a"},"auto_scroll")),"."),(0,o.kt)("h3",{id:"page-title"},"Page title"),(0,o.kt)("p",null,"Final touch - page title that could be changed as simply as:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'page.title = "Flet Chat"\npage.update()\n')),(0,o.kt)("h2",{id:"deploying-the-app"},"Deploying the app"),(0,o.kt)("p",null,"Congratulations! You have created your Chat app in Python with Flet, and it looks awesome!"),(0,o.kt)("p",null,"Now it's time to share your app with the world!"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"/docs/guides/python/deploying-web-app/hosting-providers"},"Follow these instructions")," to deploy your Flet app as a web app to Fly.io or Replit."),(0,o.kt)("h2",{id:"whats-next"},"What's next"),(0,o.kt)("p",null,"There are plenty of features we could implement to improve this chat app:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Disconnect, reconnect, session timeout"),(0,o.kt)("li",{parentName:"ul"},"Upload/download images"),(0,o.kt)("li",{parentName:"ul"},"Authentication, avatars"),(0,o.kt)("li",{parentName:"ul"},"Using database for the storage"),(0,o.kt)("li",{parentName:"ul"},"Chat channels, topics"),(0,o.kt)("li",{parentName:"ul"},"Full-text search"),(0,o.kt)("li",{parentName:"ul"},"Emojis, markdown"),(0,o.kt)("li",{parentName:"ul"},"Bots"),(0,o.kt)("li",{parentName:"ul"},"Mobile app")),(0,o.kt)("p",null,"Please let us know if you would like to contribute to the app/tutorial and share it with other Flet developers."),(0,o.kt)("h2",{id:"summary"},"Summary"),(0,o.kt)("p",null,"In this tutorial, you have learnt how to:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Create a simple Flet app;"),(0,o.kt)("li",{parentName:"ul"},"Add page controls and handle events;"),(0,o.kt)("li",{parentName:"ul"},"Use built in PubSub library;"),(0,o.kt)("li",{parentName:"ul"},"User AlertDialog for entering user name;"),(0,o.kt)("li",{parentName:"ul"},"Build page layout with reusable controls;"),(0,o.kt)("li",{parentName:"ul"},"Deploy your Flet app to the web;")),(0,o.kt)("p",null,"For further reading you can explore ",(0,o.kt)("a",{parentName:"p",href:"/docs/controls"},"controls")," and ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/flet-dev/examples/tree/main/python"},"examples repository"),"."),(0,o.kt)("p",null,"We would love to hear your feedback! Please drop us an ",(0,o.kt)("a",{parentName:"p",href:"mailto:hello@flet.dev"},"email"),", join the discussion on ",(0,o.kt)("a",{parentName:"p",href:"https://discord.gg/dzWXP8SHG8"},"Discord"),", follow on ",(0,o.kt)("a",{parentName:"p",href:"https://twitter.com/fletdev"},"Twitter"),"."))}d.isMDXComponent=!0}}]);